<!-- Add analytics via GTAG & Cookie Consent button -->

    <script src="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.js" data-cfasync="false"></script>
    <script async src="https://www.googletagmanager.com/gtag/js?id={{ .Site.GoogleAnalytics }}"></script>
    <script>
      var ga_disableString = 'ga-disable-'+{{ .Site.GoogleAnalytics }}


          window.cookieconsent.initialise({
            palette: {
              popup: {
                background: "#edeff5",
                text: "#838391"
              },
              button: {
                background: "#4b81e8"
              },
            },
            theme: "classic",
            type: "opt-in",
            position: "bottom-right",
            content: {
              message: "This website uses cookies to ensure you get the best experience on our website.\nWe use Google Analytics to know what content works best. You can see our privacy policy for more details, or directly opt out. ",
              dismiss: "Opt Out",
              allow: "Allow Cookies",
              href: "/privacy",
          },
          onInitialise: function (status) {
            var type = this.options.type;
            var didConsent = this.hasConsented();
            if (type == 'opt-in' && didConsent) {
            // enable cookies
              window.dataLayer = window.dataLayer || [];
              function gtag(){dataLayer.push(arguments);}
              gtag('js', new Date());

              gtag('config', {{ .Site.GoogleAnalytics }});
              // enable cookies
              window[ga_disableString] = false;
            }
            if (type == 'opt-out' && !didConsent) {
            // disable cookies
              window[ga_disableString] = true;
            }
          },
          onStatusChange: function(status, chosenBefore) {
            var type = this.options.type;
            var didConsent = this.hasConsented();
            if (type == 'opt-in' && didConsent) {
              // <!-- Global site tag (gtag.js) - Google Analytics -->
                window.dataLayer = window.dataLayer || [];
                function gtag(){dataLayer.push(arguments);}
                gtag('js', new Date());

                gtag('config', {{ .Site.GoogleAnalytics }});
                // enable cookies
                window[ga_disableString] = false;
            }
            if (type == 'opt-out' && !didConsent) {
            // disable cookies
              window[ga_disableString] = true;
            }
          },
          onRevokeChoice: function() {
            var type = this.options.type;
            if (type == 'opt-in') {
            // disable cookies
              window[ga_disableString] = true;
            }
            if (type == 'opt-out') {
            // enable cookies
              window.dataLayer = window.dataLayer || [];
              function gtag(){dataLayer.push(arguments);}
              gtag('js', new Date());

              gtag('config', {{ .Site.GoogleAnalytics }});
              // enable cookies
              window[ga_disableString] = false;
            }
          }
        });
    </script>
    <!-- End of cookieconsent popup -->
